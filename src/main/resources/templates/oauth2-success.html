<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>OAuth2 Success</title>
    <style>
        .token-container {
            margin: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            word-break: break-all;
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 4px;
            text-decoration: none;
            color: white;
            background-color: #4285f4;
        }
        .btn-danger {
            background-color: #dc3545;
        }
    </style>
</head>
<body>
<h1>OAuth2 Login Successful!</h1>

<div class="token-container">
    <h3>Access Token:</h3>
    <p th:text="${accessToken}"></p>

    <h3>Refresh Token:</h3>
    <p th:text="${refreshToken}"></p>
</div>

<button onclick="logout()" class="btn btn-danger">Logout</button>
<a href="/oauth2" class="btn">Back to Login Page</a>

<script>
    // Spremamo tokene lokalno nakon uspješnog logina
    localStorage.setItem('access_token', '[[${accessToken}]]');
    localStorage.setItem('refresh_token', '[[${refreshToken}]]');

    function logout() {
        fetch('/api/v1/auth/logout', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer ' + localStorage.getItem('access_token')
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Logout failed');
                }
                // Čistimo lokalno spremljene tokene
                localStorage.removeItem('access_token');
                localStorage.removeItem('refresh_token');
                // Preusmjeravamo na login stranicu
                window.location.href = '/oauth2';
            })
            .catch(error => {
                console.error('Logout error:', error);
                // Ako dođe do greške, svejedno pokušavamo očistiti lokalno stanje
                localStorage.removeItem('access_token');
                localStorage.removeItem('refresh_token');
                window.location.href = '/oauth2';
            })}
</script>
</body>
</html>