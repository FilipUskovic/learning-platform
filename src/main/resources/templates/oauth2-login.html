<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>OAuth2 Test Page</title>
    <!-- Dodajemo malo CSS-a da gumbi budu bolje stilizirani -->
    <style>
        .btn {
            display: inline-block;
            margin: 10px;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 4px;
            color: white;
            font-weight: bold;
        }

        .btn-google {
            background-color: #DB4437;
        }

        .btn-github {
            background-color: #24292e;
        }

        #user-info {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
<h1>OAuth2 Test Page</h1>

<h2>Login</h2>
<div>
    <!-- Google login s ikonom i stilizacijom -->
    <a href="/oauth2/authorization/google" class="btn btn-google">
        Login with Google
    </a>

    <!-- GitHub login s ikonom i stilizacijom -->
    <a href="/oauth2/authorization/github" class="btn btn-github">
        Login with GitHub
    </a>
</div>

<h2>Trenutni korisnik :</h2>
<div id="user-info">
    Niste prijavljeni
</div>

<script>
    function checkAuthentication() {
        const token = localStorage.getItem('access_token');
        const headers = token ? { 'Authorization': `Bearer ${token}` } : {};

        fetch('/api/v1/auth/user', { headers })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Not authenticated');
                }
                return response.json();
            })
            .then(user => {
                updateUserInfo(user);
                // Ako imamo validnog korisnika, moÅ¾emo razmotriti redirect
                if (user && !user.message) {
                    // redirect na success stranicu
                    // window.location.href = '/oauth2/redirect';
                }
            })
            .catch(error => {
                localStorage.removeItem('access_token');
                localStorage.removeItem('refresh_token');
                document.getElementById('user-info').textContent = 'Niste prijavljeni';
            });
    }

    function updateUserInfo(user) {
        const userInfoElement = document.getElementById('user-info');
        if (user.message) {
            userInfoElement.textContent = user.message;
        } else {
            const formattedInfo = JSON.stringify(user, null, 2);
            userInfoElement.textContent = formattedInfo;
        }
    }
// todo: ispraviti ovu metodu za ssession da pamtu coockies
    checkAuthentication();
</script>
</body>
</html>